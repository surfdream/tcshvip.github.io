define(function(require,exports,module){var k=require("domains");var c=require("jquery"),j=require("wmupload"),a=require("juicer");require("http://s.tcsh.me/tcsh/view/public/font-face/css/font-face.css#");var d=c("#page"),g;var i=a(["<ul>",'<li class="form_row">','<label class="row_key">真实名称：</label>',"<span>${name}</span>","</li>",'<li class="form_row">','<label class="row_key">ICO：</label>','<div class="floatleft"><img src="${icon}" class="ico_img" width="20" height="20" style="float:left"><a href="#" class="iconfont edit_ico">&#xf0022;</a><input type="file" class="form_file up_ico" /></div>',"</li>",'<li class="form_row">','<label class="row_key">昵称：</label>','<input type="text" class="form_txt w150 nickname" value="${nickname}" />',"</li>",'<li class="form_row">','<label class="row_key">优先级：</label>','<input type="text" class="form_txt txt_index w30" value="${sort}"><b class="emphasis">0，表示不展示该大类</b>',"</li>",'<li class="form_row">','<label class="row_key">上移背景色：</label>','<input type="text" class="form_txt hover_color w80" value="${bgcolor}">','<span class="bg_color" style="background: ${bgcolor}"></span>',"</li>",'<li class="form_row">','<label class="row_key">子目录：</label><a herf="#" class="showhide">收起</a>','<p class="emphasis">列：目前只支持1和2</p>','<p class="emphasis">顺序：表示在该列中的先后顺序</p>','<p class="emphasis">列和顺序，<=0表示不显示该项</p>','<ul class="floatleft sub_list list1">',"{@each itemList as list}","<li>",'<input type="text" class="form_txt w30 row_txt" value="${list.row}" placeholder="列"><input type="text" class="form_txt w30 sort_txt" value="${list.sort}" placeholder="顺序"><input type="text" class="form_txt w100 edit_txt" value="${list.nickname}" data_id="${list.id}" />','<ul class="floatleft sub_list" parent_id="${list.id}">',"{@each list.itemList as sublist}","<li>",'<input type="checkbox" class="form_chk" value="${sublist.id}" {@if sublist.sort>0}checked="checked"{@/if}><input type="text" class="form_txt w100 edit_txt" value="${sublist.nickname}" />',"</li>","{@/each}","</ul>","</li>","{@/each}","</ul>","</li>","</ul>"].join(""));var f=function(l){c.ajax({url:k.api+"/category/nav",type:"get",dataType:"jsonp",success:function(m){g=m;typeof l==="function"&&l()},error:function(){alert("getSubordinateList  Error !")}})};var b=function(){var n=d.find(".class_list");var l=[];for(var m in g){l.push('<option value="'+m+'">'+g[m].name+"</option>")}n.empty().append('<option value="0">-请选择-</option>');n.append(l.join(""))};var h=function(){var l=c(".set_nav");document.domain="wumeiwang.com";f(function(){b()});l.prepend('<li class="btns fixed_box" style="left:'+(l.offset().left+l.outerWidth())+'px"><a href="#" class="ui_btn ui_btn_h33gray15 save"><span class="ui_btn_txt">保存</span></a></li>');e()};var e=function(){var l=d.find(".nav_item");d.find(".class_list").on("change",function(){var o=c(this),n=o.val();if(!(n-0)){l.empty();return}var m=i.render(g[n]);l.empty().append(m)});d.on("click",".showhide",function(){var m=c(this);if(m.attr("hide")){m.removeAttr("hide").empty().append("收起");m.closest(".form_row").find(".sub_list .sub_list").css("display","block")}else{m.attr("hide",1).empty().append("展示");m.closest(".form_row").find(".sub_list .sub_list").css("display","none")}return false});d.on("click",".save",function(){var m={},n;m.key=d.find(".class_list").val()-0;if(!m.key){alert("请选择大类");return false}m.nickname=d.find(".nickname").val();m.index=d.find(".txt_index").val();m.hover_color=d.find(".hover_color").val();m.itemlist={};m.icon=d.find(".ico_img").attr("src");d.find(".row_txt").each(function(){var s=c(this),q=s.val()-0,t,o,r,p;if(q){t=s.closest("li");r=t.find(".sort_txt");o=t.find(".edit_txt");p=o.attr("data_id");m.itemlist[p]={id:p,nickname:o.val(),row:q,sort:r.val(),itemList:{}};t.find(".form_chk:checked").each(function(){var w=c(this),v=w.val()-0,x=w.closest("li"),u=x.find(".edit_txt");m.itemlist[p].itemList[v]={id:v,nickname:u.val()}})}});m.itemlist=JSON.stringify(m.itemlist);c.ajax({url:"http://operator.wumeiwang.com/api/category/nav",type:"post",dataType:"json",data:m,success:function(o){alert(o.message);window.location.reload()},error:function(){alert("保存异常！");window.location.reload()}});console.log(m);return false});d.on("keyup",".hover_color",function(){var o=c(this),n=o.closest(".form_row").find(".bg_color"),m=o.val();n.css("background",m)});d.on("change",".up_ico",function(){var m=c(this);j.upload(m,function(n){if(n.response){this.closest(".floatleft").find("img").attr("src",n.response.imgurl)}})})};h()});