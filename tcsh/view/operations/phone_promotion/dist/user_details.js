define(function(require,exports,module){var j=require("domains");var c=require("jquery"),h=require("lib"),d=require("wmbox"),a=require("verification"),b=require("juicer"),g=require("wmpage"),e=require("api");var i=function(){f()};var f=function(){var k=c("#page");var l={"1":[{id:1,name:"良好"},{id:2,name:"无意向"}],"0":[{id:3,name:"挂断"},{id:4,name:"无人接听"},{id:5,name:"占号"},{id:6,name:"空号"},{id:7,name:"停机"},{id:8,name:"关机"}]};var n=b(['<div class="inset_head">',"<h3>通话标记</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<ul class="wm_form">','<li class="form_row">','<label class="row_key">通话状态：</label>','<select class="form_sel call_state">','<option value="1">已通话</option>','<option value="0">未通话</option>',"</select>",'<select class="form_sel return_state">','<option value="1">良好</option>','<option value="2">无意向</option>',"</select>","</li>",'<li class="form_row">','<label class="row_key">备注：</label>','<textarea class="form_textarea"></textarea>',"</li>","</ul>",'<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));var m=function(o){return d.invBox({boxCls:"markbox",content:n.render(o),callback:function(){this.close=this.hide;var q=this,r=this.wmBox.find(".call_state"),p=this.wmBox.find(".return_state");this.wmBox.on("click",".submit",function(){e.markuser({id:global_setting.id,called:q.wmBox.find(".call_state").val()-0,call_mark:q.wmBox.find(".return_state").val()-0,remark:q.wmBox.find(".form_textarea").val(),success:function(s){if(s.response){window.location.reload()}else{alert(s.error||"系统繁忙，请稍候再试")}},error:function(){alert("系统繁忙，请稍候再试")}});return false});r.on("change",function(){var u=c(this).val(),s=[];for(var t in l[u]){s.push('<option value="'+l[u][t].id+'">'+l[u][t].name+"</option>")}p.empty().append(s.join(""))})}})};k.on("click",".markuser",function(){var p=c(this);var p=c(this),o=p.data("markBox");if(!o){o=m();p.data("markBox",o)}o.show();return false});k.on("click",".send_sms",function(){var o=c(this);if(confirm("确定发送激活短信？")){e.sendSMS({id:global_setting.id,success:function(p){if(p.response){alert("发送成功！")}else{alert("系统繁忙，请稍候再试")}},error:function(){alert("系统繁忙，请稍候再试")}})}return false});k.on("click",".send_eail",function(){var p=c(this),o=p.data("insetbox");if(!o){o=d.invBox({boxCls:"inset_mail",content:['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""),callback:function(){a.minZIndex=this.wmBox.css("z-index")-0+100;var q=this;this.close=this.hide;this.wmBox.find(".ipt_mail").val(global_setting.mail||"");this.wmBox.on("click",".submit",function(){var r;if(a.verify(q.wmBox)){r=q.wmBox.find(".ipt_mail").val();q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico loading18_18_1" style="margin-left: -10px;margin-right: 4px;"></i>邮件发送中</p>','<p style="color: #999;text-align: center;padding:6px 0">('+r+")</p>","</div>"].join(""));q.position();global_setting.mail=r;e.sendMail({id:global_setting.id,email:r,success:function(s){if(s.response){q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico hook7" style="margin-left: -10px;margin-right: 4px;"></i>发送成功！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+r+")</p>","</div>"].join(""));q.position();setTimeout(function(){window.location.reload()},1500)}else{q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico ban1" style="margin-left: -10px;margin-right: 4px;"></i>发送失败！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+r+")</p>","</div>"].join(""));q.position();setTimeout(function(){q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" value="'+r+'" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));q.position()},1000)}},error:function(){q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico ban1" style="margin-left: -10px;margin-right: 4px;"></i>发送失败！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+r+")</p>","</div>"].join(""));q.position();setTimeout(function(){q.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" value="'+r+'" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));q.position()},1000)}})}return false});this.wmBox.on("click",".close",function(){a.hideTips(q.wmBox)})}});p.data("insetbox",o)}o.show();return false})};i()});