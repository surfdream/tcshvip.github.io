define(function(require,exports,module){var j=require("domains");var c=require("jquery"),h=require("lib"),d=require("wmbox"),a=require("verification"),b=require("juicer"),g=require("wmpage"),e=require("api");require("core-css");require("theme-css");require("datepicker-css");require("jquery.ui.core")(c);require("jquery.ui.widget")(c);require("jquery.ui.datepicker")(c);require("datepicker-zh-CN")(c);var i=function(){if(global_setting&&global_setting.PageInfo){var k=g.Create({url:global_setting.PageInfo.url+"?"+c(".user_list_search").serialize(),element:".wm_page",index:global_setting.PageInfo.Index,sum:global_setting.PageInfo.TotalItems,size:global_setting.PageInfo.Size,front:true,param:global_setting.PageInfo.param,pagekey:global_setting.PageInfo.pageKey,across:true})}f()};var f=function(){var k=c("#page");var l={"1":[{id:1,name:"良好"},{id:2,name:"无意向"}],"0":[{id:3,name:"挂断"},{id:4,name:"无人接听"},{id:5,name:"占号"},{id:6,name:"空号"},{id:7,name:"停机"},{id:8,name:"关机"}]};var n=b(['<div class="inset_head">',"<h3>通话标记</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<ul class="wm_form">','<li class="form_row">','<label class="row_key">通话状态：</label>','<select class="form_sel call_state">','<option value="1">已通话</option>','<option value="0">未通话</option>',"</select>",'<select class="form_sel return_state">','<option value="1">良好</option>','<option value="2">无意向</option>',"</select>","</li>",'<li class="form_row">','<label class="row_key">备注：</label>','<textarea class="form_textarea"></textarea>',"</li>","</ul>",'<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));var m=function(o){return d.invBox({boxCls:"markbox",content:n.render(o),callback:function(){this.close=this.hide;var q=this,r=this.wmBox.find(".call_state"),p=this.wmBox.find(".return_state");this.wmBox.on("click",".submit",function(){e.markuser({id:o.id,called:q.wmBox.find(".call_state").val()-0,call_mark:q.wmBox.find(".return_state").val()-0,remark:encodeURIComponent(q.wmBox.find(".form_textarea").val()),success:function(s){if(s.response){window.location.reload()}else{alert(s.msg||"系统繁忙，请稍候再试")}},error:function(){alert("系统繁忙，请稍候再试")}});return false});r.on("change",function(){var u=c(this).val(),s=[];for(var t in l[u]){s.push('<option value="'+l[u][t].id+'">'+l[u][t].name+"</option>")}p.empty().append(s.join(""))})}})};k.on("click",".markuser",function(){var q=c(this),p=q.closest("tr"),o=q.data("markBox");if(!o){o=m({id:p.attr("data_id")});q.data("markBox",o)}o.show();return false});k.on("click",".send_sms",function(){var p=c(this),o=p.closest("tr");if(confirm("确定发送激活短信？")){e.sendSMS({id:o.attr("data_id"),success:function(q){if(q.response){alert("发送成功！")}else{alert("系统繁忙，请稍候再试")}},error:function(){alert("系统繁忙，请稍候再试")}})}return false});k.on("click",".send_eail",function(){var q=c(this),p=q.closest("tr"),o=q.data("insetbox");if(!o){o=d.invBox({boxCls:"inset_mail",content:['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""),callback:function(){a.minZIndex=this.wmBox.css("z-index")-0+100;var r=this;this.close=this.hide;this.wmBox.find(".ipt_mail").val(p.attr("data_mail")||"");this.wmBox.on("click",".submit",function(){var s;if(a.verify(r.wmBox)){s=r.wmBox.find(".ipt_mail").val();r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico loading18_18_1" style="margin-left: -10px;margin-right: 4px;"></i>邮件发送中</p>','<p style="color: #999;text-align: center;padding:6px 0">('+s+")</p>","</div>"].join(""));r.position();p.attr("data_mail",s);e.sendMail({id:p.attr("data_id"),email:s,success:function(t){if(t.response){r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico hook7" style="margin-left: -10px;margin-right: 4px;"></i>发送成功！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+s+")</p>","</div>"].join(""));r.position();setTimeout(function(){p.addClass("haslink");r.close();setTimeout(function(){r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" value="'+s+'" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""))},500)},1500)}else{r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico ban1" style="margin-left: -10px;margin-right: 4px;"></i>发送失败！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+s+")</p>","</div>"].join(""));r.position();setTimeout(function(){r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" value="'+s+'" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));r.position()},1000)}},error:function(){r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<p style="font-size: 16px;text-align: center;"><i class="wm_ico ban1" style="margin-left: -10px;margin-right: 4px;"></i>发送失败！</p>','<p style="color: #999;text-align: center;padding:6px 0">('+s+")</p>","</div>"].join(""));r.position();setTimeout(function(){r.setCon(['<div class="inset_head">',"<h3>发送邮箱</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="inset_main">','<input type="text" class="ipt_mail" value="'+s+'" wmv="empty|email" wmvmsg="无效的邮箱地址！|无效的邮箱地址！" />','<div class="btns">','<a href="#" class="close">取消</a><a href="#" class="submit">确定</a>',"</div>","</div>"].join(""));r.position()},1000)}})}return false});this.wmBox.on("click",".close",function(){a.hideTips(r.wmBox)})}});q.data("insetbox",o)}o.show();return false});k.on("click",".del_user",function(){var p=c(this),o=p.closest("tr");if(confirm("确定要删除该用户？")){e.delUser({id:o.attr("data_id"),success:function(q){if(q.response){window.location.reload()}else{alert(q.msg||"系统繁忙，请稍候再试")}},error:function(){alert("系统繁忙，请稍候再试")}})}return false});k.find(".show_date").datepicker()};i()});