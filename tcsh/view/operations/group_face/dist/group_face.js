define(function(require,exports,module){var h=require("domains");var c=require("jquery"),b=require("juicer"),g=require("wmupload"),a=require("verification"),d=require("wmbox");window.document.domain="tcsh.me";var f=function(){e()};var e=function(){var i=c("#page");var j=b(['<div class="afb_head">',"<h3>添加社徽</h3>",'<a href="#" class="iconfont close">&#xf00b3;</a>',"</div>",'<div class="afb_main">','<form action="'+h.operator+'/commune/sys_icon/add.json" method="post">','<div class="wm_form">',"<ul>",'<li class="form_row">','<label class="row_key"><b class="form_must">*</b>标题：</label>','<input type="text" class="form_txt" name="title" value="${name}" wmv="empty" wmvmsg="标题不能为空！" />',"</li>",'<li class="form_row">','<label class="row_key"><b class="form_must">*</b>图片：</label>','<img src="" style="display:none" />','<span href="#" class="iconfont upface" style="vertical-align: top;margin-left: 10px;">&#xf0024;</span>','<input type="file" class="form_file" />','<input type="hidden" class="face_url" name="imagePath" />',"</li>","</ul>","</div>",'<div class="btns">','<a href="#" class="close">取消</a><input type="submit" class="submit" value="确定">',"</div>","</form>","</div>"].join(""));i.on("click",".add_face",function(){var l=c(this),k=l.data("face_box");if(!k){k=d.invBox({boxCls:"af_box",content:j.render({}),callback:function(){var m=this;this.wmBox.find(".form_file").on("change",function(){g.upload(c(this),function(n){var o=this.closest(".form_row");if(n.response){o.find("img").attr("src",n.response.imgurl).css("display","block");o.find(".face_url").val(n.response.imgurl)}})});this.wmBox.on("click",".submit",function(){return a.verify(m.wmBox)})}});l.data("face_box",k)}k.show();return false});i.on("click",".remove_face",function(){var k=c(this).closest("li");c.ajax({url:h.operator+"/commune/sys_icon/delete.json",data:{ids:k.attr("data_id")},success:function(l){if(l.success){k.fadeOut(function(){k.remove()})}}});return false})};f()});