define(function(require,exports,module){var b=require("http://s.tcsh.me/tcsh/model/lib/jquery/seajs-jquery-1.8.3.min.js"),c=require("http://s.tcsh.me/tcsh/model/wmbox/dist/wmbox.js"),a=require("http://s.tcsh.me/tcsh/model/lib/juicer/seajs-juicer-min.js"),h=require("http://s.tcsh.me/tcsh/model/wmupload/dist/wmupload.js"),f=require("http://s.tcsh.me/tcsh/model/lib/dist/lib.js"),e=require("http://s.tcsh.me/tcsh/model/wmpage/dist/wmpage.js");require("../css/style.css#");var g=function(){var i;window.document.domain="56chnc.com";if(f.queryString("edit_page")){i=b(".setdata_mask");i.css({display:"block"});i.empty().append(['<a href="#" class="edit_btn iconfont opacity_btn" title="透明显示">&#xf00e9;</a>','<a href="#" class="edit_btn iconfont edit_data" title="添加数据">&#xf013e;</a>',])}if(f.queryString("location")){i=b(".setdata_mask");i.css({display:"block"});i.empty().append(['<a href="#" class="edit_btn iconfont location_btn" title="定位">&#xf018b;</a>',])}d()};var d=function(){var j=b("#page");var i=function(){return this.attr("data_page_url")+"_"+this.attr("data_ad_code")};var k=a(["{@each success.products as item}",'<li class="comm_item" data_img="${item.picUrl}" data_id="${item.itemId}" data_name="${item.title}" data_imgs="${item.itemImgs}">','<div class="show_comm">','<img src="${item.picUrl}">','<span class="comm_name">${item.title}</span>',"</div>","</li>","{@/each}"].join(""));var m=a(["{@each success as item}",'<tr data_img="${item.picUrl}" data_id="${item.id}" data_name="${item.title}" data_imgs="${item.itemImgs}" data_chkimg="${item.advertPic}" data_description="${item.pd}">','<td class=""><img src="${item.advertPic}"></td>',"<td>${item.title}</td>",'<td class="w100">','<div class="btn_list">','<a href="#" class="link set_old_data" target="_blank">编辑已有数据<span class="wm_ico arrow9down"></span></a>',"<ul>",'<li class="btn_list_last">','<a href="#" class="set_old_data" target="_blank">编辑已有数据</a>',"</li>",'<li class="btn_list_end">','<a href="#" class="del">删除</a>',"</li>","</ul>","</div>","</td>","</tr>","{@/each}"].join(""));var l=a(['<a href="#" class="returnprev"><span class="iconfont">&#xf0007;</span>返回</a>',"<ul>",'<li class="form_row">','<label class="row_key"><b class="form_must">*</b>商品名称：</label><input type="text" class="form_txt w500 comm_name" value="${name}" />',"</li>",'<li class="form_row">','<label class="row_key">商品描述：</label><input type="text" class="form_txt w500 comm_description" value="${description}" />',"</li>",'<li class="form_row">','<label class="row_key"><b class="form_must">*</b>图片：</label>','<div class="custom_img_btn">','<input type="file" class="form_file upimg" /><span class="ui_btn ui_btn_h27gray8"><span class="ui_btn_txt">上传自定义</span></span>',"</div>",'<div class="chkimg_box">',"<fieldset>",'<ul class="img_list">','<li class="chkimg_item" data_img="${img}"><img src="${img}"><span class="iconfont">&#xe60c;</span></li>',"{@each imgs as item}",'<li class="chkimg_item" data_img="${item}"><img src="${item}"><span class="iconfont">&#xe60c;</span></li>',"{@/each}","</ul>","</fieldset>","</div>","</li>",'<li class="form_row">','<label class="row_key">&nbsp;</label><a href="#" class="ui_btn ui_btn_h26blue2 submit" data_id="${id}" data_post_url="${post_url}"><span class="ui_btn_txt">确定</span></a>',"</li>","</ul>"].join(""));j.on("click",".opacity_btn",function(){b(this).closest(".setdata_mask").toggleClass("opacity_mask");return false});j.on("click",".edit_data",function(){var o=b(this),n=o.data("edit_box");if(!n){n=c.alert({titleText:"选择数据",boxCls:"uz_box chk_data",content:['<div class="chk_data_main new_data">','<div class="edit_box wm_form">',"</div>",'<div class="data_tab">','<a href="#" class="tab_link curr" data_key="new_data">添加数据</a>','<a href="#" class="tab_link" data_key="old_data">已有数据</a>',"</div>",'<div class="old_data">','<a href="#" class="iconfont f5" title="刷新">&#xf015c;</a>','<div class="limit_box">','<table class="data_tblist" cellpadding="0" cellspacing="0">',"<thead>","<tr>",'<th class="w60">图片</th>',"<th>标题</th>",'<th class="w100">操作</th>',"</tr>","</thead>","<tbody></tbody>","</table>","</div>",'<a href="#" class="ui_btn ui_btn_h26blue2 close"><span class="ui_btn_txt">确定</span></a>',"</div>",'<div class="new_data">','<div class="search wm_form">',"<ul>",'<li class="form_row nowrap">','<label class="row_key">商品id：</label><input type="text" class="form_txt search_comm_id" />',"</li>",'<li class="form_row nowrap">','<a href="#" class="ui_btn ui_btn_h24green4 search_btn"><span class="ui_btn_txt">搜索</span></a>',"</li>","</ul>","</div>",'<ul class="data_list"></ul>','<div class="wm_page"></div>',"</div>","</div>"].join(""),btns:[],callback:function(){var z=this;this.close=this.hide;var t=this.wmBox.find(".chk_data_main"),y=t.find(".search"),w=t.find(".data_tab"),s=t.find(".new_data"),A=t.find(".old_data"),v=t.find(".edit_box");var u;var x=function(B){b.ajax({url:"http://www.56chnc.com/product/list.json",data:{searchKey:B.search_key||"",page:1,count:24},dataType:"json",success:function(C){if(C.success){s.find(".data_list").empty().append(k.render(C));u=e.Create({url:"http://www.56chnc.com/product/list.json",async:true,size:24,index:1,sum:C.success.productCount,pagekey:"page",dataType:"json",front:true,param:{count:24,productCount:C.success.productCount},success:function(D){if(D.success){s.find(".data_list").empty().append(k.render(D));u.setIndex(this.index)}},error:function(){alert("获取商品数据，系统繁忙！")}})}},error:function(){alert("服务器繁忙！")}})};var r=function(B){b.ajax({url:"http://www.56chnc.com/advert/pro_list.json",data:{advertCode:encodeURIComponent(i.call(o.closest(".setdata_mask")))},dataType:"json",success:function(C){if(C.success){A.find(".data_tblist tbody").empty().append(m.render(C))}},error:function(){alert("获取已配置数据，服务器繁忙！")}})};x({});r({});var p=function(C){var B;v.empty().append(l.render(C));B=v.find(".chkimg_item[data_img='"+C.chkimg+"']");v.find(".chkimg_item[data_img='"+C.chkimg+"']").addClass("curr");if(C.chkimg&&!B.length){v.find(".img_list").prepend('<li class="chkimg_item curr" data_img="'+C.chkimg+'"><img src="'+C.chkimg+'"><span class="iconfont">&#xe60c;</span></li>')}v.stop(true,true).animate({left:0})};var q=function(){v.stop(true,true).animate({left:800})};this.wmBox.on("click",".search_btn",function(){x({search_key:y.find(".search_comm_id").val()});return false});this.wmBox.on("click",".submit",function(){var E=b(this);var B=b.trim(v.find(".comm_name").val()),C=v.find(".chkimg_item.curr:eq(0)").attr("data_img");if(!B||!C){alert("请填写完整数据！");return false}var D=b('<div class="submit_mask">保存中...</div>');t.append(D);b.ajax({url:E.attr("data_post_url"),data:{title:encodeURIComponent(B),pd:encodeURIComponent(v.find(".comm_description").val()),productId:E.attr("data_id"),id:E.attr("data_id"),advertCode:encodeURIComponent(i.call(o.closest(".setdata_mask"))),advertPic:encodeURIComponent(C)},dataType:"json",success:function(F){if(F.success){D.empty().append('<span class="countdown_msg">保存成功！3秒后返回列表</span>');f.countdown({parent:D,ele:".countdown_msg",countdownModel:'<span class="countdown_msg">保存成功！${i}秒后返回列表</span>',start:3,endCallBack:function(){D.remove();q()}})}else{D.empty().append('<span class="countdown_msg">'+(F.error||"保存失败")+"！3秒后关闭</span>");f.countdown({parent:D,ele:".countdown_msg",countdownModel:'<span class="countdown_msg">'+(F.error||"保存失败")+"！${i}秒后关闭</span>",start:3,endCallBack:function(){D.remove()}})}},error:function(){D.empty().append('<span class="countdown_msg">服务器繁忙！3秒后关闭</span>');f.countdown({parent:D,ele:".countdown_msg",countdownModel:'<span class="countdown_msg">服务器繁忙！${i}秒后关闭</span>',start:3,endCallBack:function(){D.remove()}})}});return false});this.wmBox.on("click",".comm_item",function(){var B=b(this);p({id:B.attr("data_id"),name:B.attr("data_name"),img:B.attr("data_img"),imgs:B.attr("data_imgs").split(","),post_url:"http://www.56chnc.com/advert/pro_add"});return false});this.wmBox.on("click",".set_old_data",function(){var C=b(this),B=C.closest("tr");p({id:B.attr("data_id"),name:B.attr("data_name"),img:B.attr("data_img"),imgs:B.attr("data_imgs").split(","),chkimg:B.attr("data_chkimg"),description:B.attr("data_description"),post_url:"http://www.56chnc.com/advert/edit.json"});return false});this.wmBox.on("click",".tab_link",function(){var B=b(this);w.find(".curr").removeClass("curr");B.addClass("curr");t.attr("class","chk_data_main "+B.attr("data_key"));return false});this.wmBox.on("click",".chkimg_item",function(){v.find(".curr").removeClass("curr");b(this).addClass("curr");return false});this.wmBox.on("click",".returnprev",function(){q();return false});this.wmBox.on("change",".upimg",function(){var B=b(this);h.setUploadUrl("http://www.56chnc.com/product/upload");h.upload(B,function(C){if(C.response){v.find(".img_list").prepend('<li class="chkimg_item" data_img="'+C.response.imgUrl+'"><img src="'+C.response.imgUrl+'"><span class="iconfont">&#xe60c;</span></li>')}})});this.wmBox.on("click",".f5",function(){r({});return false});this.wmBox.on("click",".del",function(){var C=b(this),B=C.closest("tr");if(confirm("确定要删除该商品？\n删除后无法恢复")){b.ajax({url:"http://www.56chnc.com/advert/del.json",data:{id:B.attr("data_id")},success:function(D){if(D.success){B.remove()}else{alert(D.error||"删除失败！")}},error:function(){alert("服务器繁忙！")}})}return false})}});o.data("edit_box",n)}n.show();return false});j.on("click",".location_btn",function(){var o=b(this).closest(".setdata_mask");var n=prompt("请输入位子描述\n如：首页头部1190*200_1广告");b.ajax({url:"http://www.56chnc.com/advert/aou",data:{advertCode:encodeURIComponent(i.call(o.closest(".setdata_mask"))),advertName:encodeURIComponent(n)},dataType:"json",success:function(p){if(p.success){o.remove()}else{alert(p.error||"定位失败！")}},error:function(){alert("服务器繁忙！")}});return false})};g()});