define(function(require,exports,module){var i=require("domains");var d=require("jquery"),c=require("juicer"),a=require("wmlazyload"),e=require("wmbox"),g=require("lib"),b=require("wmforimg");require("jquerymobile")(d);var h=function(){var j=new b.Shuffle({forImgBoxEle:".img_box",callback:function(){var o=d(".img_box");var n=this;var m=this.forImgItem.length;var k=this.forImgBox.find(".indexBox"),l=[];while(m--){l[m]='<li class="index_item"></li>'}k.append(l.join(""));this.indexs=k.find(".index_item");this.indexs.eq(0).addClass("curr");this.forImgBox.on("swipeleft",function(){n.next()});this.forImgBox.on("swiperight",function(){n.prev()})}});d("table,img").removeAttr("width").removeAttr("height").css({width:"auto",height:"auto"});a.init();f()};var f=function(){var k=d("#page");k.on("click","img",function(){var m=d(this),l;l=m.data("showartwork");if(!l){l=e.invBox({boxCls:"showartwork",content:'<div class="img_bg" style="background:#000;text-align: center;height: 100%;"><img src="'+m.attr("src")+'" style="max-width:100%;max-height:100%;vertical-align: middle;" /></div>',callback:function(){var n=this;this.close=this.hide;this.wmBox.find(".img_bg").css({"line-height":this.wmBox.height()+"px"});this.wmBox.on("swipe",function(){return false});this.wmBox.on("click",function(){n.close();return false})}});m.data("showartwork",l)}l.show();return false});var j=function(){return c(['<form class="wm_form" action="http://m.tcsh.me/present/pre_order">','<div class="attr_box_head">',"<h3>礼物规格选择</h3>",'<a href="#" class="close">×</a>',"</div>","<ul>","{@each relation as item}",'<li class="form_row" >','<label class="row_key">${item.key}：</label>','<ul class="floatleft options_list">',"{@each item.itemList as list}",'<li class="options_item" data_id="${list.id}">','<a href="#" hidefocus="true" style="{@if list.src}padding:0;{@/if}" title="${list.name}" data_key="${item.key}" data_value="${list.name}" data_id="${list.id}" class="buy_attr">{@if list.src}<img src="${list.src}" class="showbigimg" />{@else}${list.name}{@/if}</a>',"</li>","{@/each}","</ul>","</li>","{@/each}","</ul>",'<div class="btns"><input type="submit" value="填写地址，准备收货" id="submit" /></div>','<input type="hidden" name="id" value="'+global_setting.data.id+'"/>','<input type="hidden" name="productid" value="'+global_setting.data.productId+'"/>','<input type="hidden" name="active_phone" value="'+g.queryString("active_phone")+'"/>','<input type="hidden" name="sign" value="'+g.queryString("sign")+'"/>','<input type="hidden" class="patternstr" name="PatternStr" value=""/>',"</form>"].join(""),SpecificationData)};k.on("click",".receive_btn",function(){e.invBox({boxId:"attr_box",content:j(),callback:function(){var l=this;this.wmBox.on("click",".options_item",function(){var n=d(this),m=n.closest(".options_list");m.find(".curr").removeClass("curr");n.addClass("curr");return false});this.wmBox.on("click","#submit",function(){var m=[];d(".options_item.curr").each(function(){m.push(d(this).attr("data_id"))});l.wmBox.find(".patternstr").val(m.join(","));if(d(".options_list").length!==d(".options_item.curr").length){alert("请选择属性");return false}})}});return false})};h()});