define(function(require,exports,module){require("http://s.tcsh.me/tcsh/model/wmarea/css/style.css");var d=require("http://s.tcsh.me/tcsh/model/lib/jquery/seajs-jquery-1.8.3.min.js"),c=require("http://s.tcsh.me/tcsh/model/lib/juicer/seajs-juicer-min.js"),e=require("http://s.tcsh.me/tcsh/model/wmbox/dist/wmbox.js"),f=require("http://s.tcsh.me/tcsh/model/wmarea/dist/area_data_relationship.js"),b=require("http://s.tcsh.me/tcsh/model/wmarea/dist/area_data.js");var a=function(i){var h=c(['<div class="chk_area_head">','<a href="#" class="close">×</a>',"<h3>选择区域</h3>","</div>",'<div class="area_province">',"<ul>","{@each relationship as list,index}",'<li class="area_item clearfix">','<span class="floatleft w70">','<input type="checkbox" class="chk_item chkedsub" id="area_${key}_${index}" /><label class="chk_key" for="area_${key}_${index}"><b>${list.name}</b></label>',"</span>",'<div class="floatleft w480 provincelist" data_ids="{@each list.cityList as item}${item},{@/each}">',"</div>","</li>","{@/each}","</ul>","</div>",'<div class="btns">','<a href="#" class="ui_btn ui_btn_h27gray8 submit"><span class="ui_btn_txt">确定</span></a>',"</div>",].join(""));h=d(h.render(i));h.find(".provincelist").each(function(){var p=d(this);var o=p.attr("data_ids");o=o.substr(0,o.lastIndexOf(",")).split(",");p.empty();for(var m in o){var q=d(['<div class="province_box">',"<span>",'<input type="checkbox" class="chk_item province_item" data_name="'+b.data_province[o[m]]+'" data_id="'+o[m]+'" id="province_'+i.key+"_"+o[m]+'" />','<label class="chk_key" for="province_'+i.key+"_"+o[m]+'">'+b.data_province[o[m]]+"</label>",'<b class="sum"></b>','<a href="#" class="wm_ico arrow9down showcity"></a>',"</span>",'<div class="city_list"><ul><a href="#" class="cityhide">×</a></ul></div>',"</div>"].join(""));var l=q.find(".city_list ul");var n=b.data_city[o[m]];for(var k in n){l.append('<li><input type="checkbox" class="city_item" id="city_'+i.key+"_"+n[k].value+'" data_name="'+n[k].name+'" data_id="'+n[k].value+'" /><label for="city_'+i.key+"_"+n[k].value+'">'+n[k].name+"</label></li>")}p.append(q)}});return h};var g=function(l){var h=this;var i=d.extend({},l);var k={key:parseInt(Math.random()*999)+100,relationship:f};var j=e.invBox({boxCls:"chk_area_box",content:a(k),callback:function(){var m=this;this.close=function(){m.hide()}}});j.close=function(){h.hide()};j.wmBox.on("change",".chkedsub",function(){var n=d(this),m=n.closest(".area_item");if(n.attr("checked")){m.find(".province_item:enabled").attr("checked","checked").change()}else{m.find(".province_item:enabled").removeAttr("checked").change()}});j.wmBox.on("click",".showcity",function(){var n=d(this),m=n.closest(".area_province");m.find(".province_box_showcity").removeClass("province_box_showcity");n.closest(".province_box").addClass("province_box_showcity");return false});j.wmBox.on("change",".province_item",function(){var o=d(this),n=o.closest(".province_box").find(".city_list"),m=o.closest(".area_item");if(o.attr("checked")){n.find(".city_item:enabled").attr("checked","checked")}else{n.find(".city_item:enabled").removeAttr("checked")}if(m.find(".province_item").length===m.find(".province_item:checked").length){m.find(".chkedsub").attr("checked","checked")}else{m.find(".chkedsub").removeAttr("checked")}});j.wmBox.on("change",".city_item",function(){var m=d(this),n=m.closest(".province_box");if(m.attr("checked")&&n.find(".city_item").length===n.find(".city_item:checked").length){n.find(".province_item:enabled").attr("checked","checked")}else{n.find(".province_item:enabled").removeAttr("checked")}});j.wmBox.on("change",".province_item,.city_item",function(){var n=d(this),o=n.closest(".province_box"),m=o.find(".sum"),p=o.find(".city_item:checked").length;m.empty();if(p){m.append("("+p+")")}});j.wmBox.on("click",".cityhide",function(){var m=d(this);m.closest(".province_box").removeClass("province_box_showcity");return false});j.wmBox.on("click",".submit",function(){var m=d(this);h.hide();typeof i.submitCallback==="function"&&i.submitCallback.call(h);return false});this.Box=j.wmBox;this.getVal=function(){var m={};m.cityList=[];m.provinceList=[];j.wmBox.find(".city_item:checked").each(function(){var n=d(this);m.cityList.push({id:n.attr("data_id"),name:n.attr("data_name")})});j.wmBox.find(".province_item:checked").each(function(){var n=d(this);m.provinceList.push({id:n.attr("data_id"),name:n.attr("data_name")})});return m};this.show=function(m){typeof i.callback==="function"&&i.callback.call(h);typeof m==="function"&&m.call(h);j.show()};this.hide=function(){j.hide()};this.close=function(){j.close()};this.empty=function(){h.Box.remove();j.mask.remove()};this.provinceList=j.wmBox.find(".province_box");this.areaBoxList=j.wmBox.find(".area_item");typeof i.callback==="function"&&i.callback.call(this)};return function(h){return new g(h)}});
