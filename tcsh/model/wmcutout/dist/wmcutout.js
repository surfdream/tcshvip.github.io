define(function(require,exports,module){var c=require("http://s.tcsh.me/tcsh/model/lib/jquery/seajs-jquery-1.8.3.min.js"),d=require("../../wmmove/dist/wmmove.js"),a=require("../../wmchangewhbox/dist/wmchangewhbox.js");var b=function(l){var e=this;var k;var f=c.extend({parentBox:".cutout_parent",cutoutRangeEle:".cutout_range",cutoutSourceEle:".cutout_source",cutoutLimitEle:".cutout_limit",cutoutPreviewEle:".previewitem",changewh:false},l);var h=function(){var o=this;var n=e.$cutoutSource.width(),m=e.$cutoutSource.height();e.$cutoutPreview.each(function(){var s=c(this).data("imgClone");var r=n/s.width(),p=m/s.height;var q=n/m;s.css({"margin-top":-(o.position.top/p),"margin-left":-(o.position.left/r)})})};var g=function(){var n,p,m,o;e.$cutoutSource.width("auto");e.$cutoutSource.height("auto");n=e.$cutoutSource.outerWidth(),p=e.$cutoutSource.outerHeight(),m=Math.max(n,p);if(m===n){e.$cutoutSource.width(e.maxWidth-2)}if(m===p){e.$cutoutSource.height(e.maxHeight-2)}n=e.$cutoutSource.width();p=e.$cutoutSource.height();e.$cutoutSource.width(n);e.$cutoutSource.height(p);e.$cutoutLimit.width(n);e.$cutoutLimit.height(p);o=Math.min(n,p);e.$cutoutRange.width(o);e.$cutoutRange.height(o);e.limit=o};var i=function(){k=d.create({moveEle:f.cutoutRangeEle,parentEle:f.cutoutLimitEle,moveOffset:{top:-21,left:-21},event:f.event,mousemoveCallback:function(){var n=this;var m=this.$moveBox.position();h.call({position:m,width:n.$moveBox.width(),height:n.$moveBox.height()})}});if(f.changewh){a.create({changeEle:f.cutoutRangeEle,paeentBox:f.cutoutLimitEle,changeBtnDownCallback:function(){k.stop=true},changeBtnUpCallback:function(){k.stop=false},changePX:function(){var r=this;var o,q,n,p,m;m=(this.pageX-this.offsetX-this.outerWidth)+(this.pageY-this.offsetY-this.outerHeight);n=r.width+m/2,p=r.height+m/2;o=r.$paeentBox.outerWidth();q=r.$paeentBox.outerHeight();if(r.parentTop+p>q){n=p=q-r.parentTop}if(r.parentLeft+n>o){p=n=o-_parentLeft}return{Width:n,Height:p}},changeBtnMousemoveCallback:function(){var n=this;var m=this.$changeBox.position();h.call({position:m,width:n.width,height:n.height})}})}j()};var j=function(){e.$cutoutSource.load(function(){g();var n,p,o,m;n=e.$cutoutSource.width();p=e.$cutoutSource.height();o=Math.min(n,p);m=n/p;e.$cutoutPreview.each(function(){var u=c(this);var x=e.$cutoutSource.clone();var w=n,s=p;var y=u.width(),t=u.height(),q=Math.min(t,y),r,v;if(y<n&&t<p){w=w*(y/w);s=w*(t/s)}if(y>n){w=y;s=w/m}else{}if(t>s){s=t;w=s*m}x.css({width:w,height:s});u.data("imgClone",x);u.empty().append(x)})});e.$cutoutSource.load()};this.$parentBox=c(f.parentBox);this.$cutoutRange=c(f.cutoutRangeEle);this.$cutoutPreview=c(f.cutoutPreviewEle);this.$cutoutLimit=this.$cutoutRange.closest(f.cutoutLimitEle);this.$cutoutSource=this.$parentBox.find(f.cutoutSourceEle);this.maxWidth=this.$parentBox.width();this.maxHeight=this.$parentBox.height();this.limit=0;this.setCutoutSource=function(m){if(!m){return false}if(typeof m.src==="string"){e.$cutoutSource.attr("src",m.src);e.$cutoutSource.load()}};this.stop=function(m){k.stop=m};i()};exports.create=function(e){return new b(e)}});
