define(function(require,exports,module){var k=require("http://s.tcsh.me/tcsh/model/domains/dist/domains.js");var g=require("http://s.tcsh.me/tcsh/model/lib/jquery/seajs-jquery-1.8.3.min.js");var f=require("http://s.tcsh.me/tcsh/model/lib/juicer/seajs-juicer-min.js");var h=f('<a href="${_href}" class="page_link" value="${dataval}">${val}</a>'),d=f('<a href="${_href}" class="page_before page_link" value="${dataval}">${val}</a>'),b=f('<a href="${_href}" class="page_next page_link" value="${dataval}">${val}</a>'),c=f('<a href="${_href}" class="page_link" value="${dataval}">${val}</a>');require("http://s.tcsh.me/tcsh/model/wmpage/css/style.css#");var e=function(l){return l instanceof g?l:g(l)};var j=function(m){var l;if(!m){return}this.$element=e(m.element||".wm_page");this.index=(m.index-0)||1;this.start=(m.start-0)||0;this.size=(m.size-0)||20;this.sum=(m.sum-0)||1;this.url=m.url||"";this.showItemLength=(m.showItemLength-0)||5;this.pagekey=m.pagekey||"page";if(this.sum&&this.size){l=this.sum/this.size;this.pageItemLength=parseInt(l)===l?l:parseInt(l)+1}};var i=function(p){var m,o;var l=this;var n=function(s){var q=l.url,r;q+=q.indexOf("?")>=0?"&":"?";r=g.extend({},p.param);r[l.pagekey]=s;q+=g.param(r);return q};if(p.isStart){o=function(){var s,r=[],t,q,u=parseInt((l.start||0)/l.size)+1;s=l.pageItemLength>l.showItemLength?l.showItemLength:l.pageItemLength;if(l.start/l.size!=parseInt(l.start/l.size)){s+=1;u+=1}r.push("<span>共"+l.pageItemLength+"页</span>");if(l.start>0){r.push(d.render({_href:n(l.start-l.size<0?0:l.start-l.size),dataval:l.start-l.size<0?0:l.start-l.size,val:"<"}))}else{r.push(d.render({_href:"javascript:void(0);",dataval:"javascript:void(0);",val:"<"}))}if(p.front&&u>=l.showItemLength){r.push(c.render({_href:n(0),dataval:"0",val:"1"}));r.push('<span class="ellipsis">...</span>')}if(u>l.pageItemLength-l.showItemLength){t=l.pageItemLength-l.showItemLength<=0?0:l.pageItemLength-l.showItemLength;u=u>l.pageItemLength?l.pageItemLength:u;for(;t<l.pageItemLength;t++){q=t+1;if(q==u){r.push("<b>"+q+"</b>")}else{r.push(h.render({_href:n((q-1)*l.size),dataval:(q-1)*l.size,val:q}))}}}else{if(u<l.showItemLength){for(t=0;t<s;t++){q=t+1;if(q==u){r.push("<b>"+u+"</b>")}else{r.push(h.render({_href:n((q-1)*l.size),dataval:(q-1)*l.size,val:q}))}}}else{for(t=-1;t<s-1;t++){q=u+t;if(q==u){r.push("<b>"+u+"</b>")}else{r.push(h.render({_href:n((q-1)*l.size),dataval:(q-1)*l.size,val:q}))}if(q>l.pageItemLength-1){s=Number.MAX_VALUE;break}}}s<l.pageItemLength&&r.push('<span class="ellipsis">...</span>')}if(u+1>l.pageItemLength){r.push(b.render({_href:"javascript:void(0);",dataval:"javascript:void(0);",val:">"}))}else{q=u+1;r.push(b.render({_href:n(l.start+l.size),dataval:l.start+l.size,val:">"}))}return r.join("")}}else{o=function(){var s,r=[],t,q;s=l.pageItemLength>l.showItemLength?l.showItemLength:l.pageItemLength;r.push("<span>共"+l.pageItemLength+"页</span>");if(l.index-1>0){r.push(d.render({_href:n(l.index-1),dataval:l.index-1,val:"<"}))}else{r.push(d.render({_href:"javascript:void(0);",dataval:"javascript:void(0);",val:"<"}))}if(p.front&&l.index>l.showItemLength){r.push(c.render({_href:n(1),dataval:"1",val:"1"}));r.push('<span class="ellipsis">...</span>')}if(l.index>l.pageItemLength-l.showItemLength){t=l.pageItemLength-l.showItemLength<=0?0:l.pageItemLength-l.showItemLength;l.index=l.index>l.pageItemLength?l.pageItemLength:l.index;for(;t<l.pageItemLength;t++){q=t+1;if(q==l.index){r.push("<b>"+q+"</b>")}else{r.push(h.render({_href:n(q),dataval:q,val:q}))}}}else{if(l.index<l.showItemLength){for(t=0;t<s;t++){q=t+1;if(q==l.index){r.push("<b>"+l.index+"</b>")}else{r.push(h.render({_href:n(q),dataval:q,val:q}))}}}else{for(t=-1;t<s-1;t++){q=l.index+t;if(q==l.index){r.push("<b>"+l.index+"</b>")}else{r.push(h.render({_href:n(q),dataval:q,val:q}))}if(q>l.pageItemLength-1){s=Number.MAX_VALUE;break}}}s<l.pageItemLength&&r.push('<span class="ellipsis">...</span>')}if(l.index+1>l.pageItemLength){r.push(b.render({_href:"javascript:void(0);",dataval:"javascript:void(0);",val:">"}))}else{q=l.index+1;r.push(b.render({_href:n(q),dataval:q,val:">"}))}p.across&&r.push('<span>跳转至</span><input type="text" class="pageacross_txt" /><span>页</span><input type="button" class="pageacross_btn" value="确定" />');return r.join("")}}j.apply(this,arguments);if(!this.url){throw"pageModel url parameter is null or undefined"}m=o();this.$element.each(function(){g(this).empty().append(m)});this.$element.on("click",".pageacross_btn",function(){var r=g(this).parent().find(".pageacross_txt");var q=g.trim(r.val())-0;if(q){window.location.href=n(q)}else{alert("异常翻页！");r.val("").focus()}return false});this.restItem=function(){var q=o();l.$element.each(function(){g(this).empty().append(q)})};this.setIndex=function(r){l.index=r;var v,w,u,t;var s=r+1,q=r-1;s=s>l.pageItemLength?l.pageItemLength:s;q=q<1?1:q;v=l.$element.find('.page_link:not(.page_before):not(.page_next)[value="'+r+'"]');t=l.$element.find("b");if(v.length){t.replaceWith(h.render({_href:n(t.html()),dataval:t.html(),val:t.html()}));v.replaceWith("<b>"+l.index+"</b>")}w=l.$element.find('.page_link:not(.page_before):not(.page_next)[value="'+s+'"]');u=l.$element.find('.page_link:not(.page_before):not(.page_next)[value="'+q+'"]');if(!w.length||!u.length){this.restItem()}l.$element.find(".page_before").replaceWith(d.render({_href:r===q?"javascript:void(0);":n(q),dataval:q,val:"<"}));l.$element.find(".page_next").replaceWith(b.render({_href:r===s?"javascript:void(0);":n(s),dataval:s,val:">"}))}};var a=function(m){var l=new i(m);l.$element.off("click.page").on("click.page",".page_link",function(){var q=g(this),n=q.attr("href"),p={};if(n.indexOf("?")<0){return false}p.index=g.trim(q.attr("value"))-0;var o={url:n,type:"get",dataType:m.dataType||"json",success:function(r){if(typeof m.success==="function"){m.success.call(p,r)}},error:function(){if(typeof m.error==="function"){m.error.call(p)}}};if(typeof m.ajaxAgo==="function"){m.ajaxAgo(p)&&g.ajax(o)}else{g.ajax(o)}return false});return l};exports.Create=function(l){if(l.async){return new a(l)}else{return new i(l)}};exports.CreateStartPage=function(l){l.isStart=true;return exports.Create(l)}});