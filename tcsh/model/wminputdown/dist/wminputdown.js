define(function(require,exports,module){var d=require("http://s.tcsh.me/tcsh/model/lib/jquery/seajs-jquery-1.8.3.min.js"),c=require("http://s.tcsh.me/tcsh/model/lib/juicer/seajs-juicer-min.js");var b=function(g){return g instanceof d?g:d(g)};var f=function(){var h=d("body"),g=h[0];return g.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0};var e=function(i){var h=d(window),g=d("body");h.on("resize.downList",function(){g.find(".input_downlist:visible").each(function(){var l=d(this),k=l.data("createData"),j=k.input.offset();if(l.css("position")==="fixed"){j.top=j.top-f()+k.input.outerHeight()}else{j.top=j.top+k.input.outerHeight()}l.css({top:j.top,left:j.left})})});e=function(p){var n=d("body"),k=this,j,o,l,m;if(d.browser.msie&&d.browser.version){this.$downBox[0].onselectstart=function(){return false}}this.$input.on("keydown",function(t){if(t.keyCode==38||t.keyCode==40){var s=d(this),r=n.find("#"+s.attr("for")),q;k.showDownList();m=r.find("."+p.chkedClass);if(!m.length){m=r.find("."+p.itemClass+":eq(0)");m.addClass(p.chkedClass)}else{m.removeClass(p.chkedClass);q=t.keyCode==40?m.next():m.prev();if(q.length){q.addClass(p.chkedClass)}else{r.find("."+p.itemClass+(t.keyCode==40?":first":":last")).addClass(p.chkedClass)}}m=r.find("."+p.chkedClass);j=m.position();l=m.outerHeight();o=r.outerHeight();if(j.top<0){r.scrollTop(r.scrollTop()+j.top)}if(j.top+l>o){r.scrollTop(r.scrollTop()+(j.top+l-o))}typeof p.updownCallback==="function"&&p.updownCallback.call(p.input,r.find("."+p.chkedClass));return false}if(t.keyCode==13){k.hideDownList()}})};e.call(this,i)};var a=function(k){var o=this;var h=d.extend({input:null,chkedClass:"curr",itemClass:"input_downitem",updownCallback:function(p){this.val(p.attr("data_text"))}},k);var j=d("body"),m,l,i,n,g=c(h.listItemModel||'<ul>{@each list as item}<li class="'+h.itemClass+'" data_text="${item.txt}">${item.txt}</li>{@/each}</ul>');if(!h.input){throw"parameter input wminputdown created can not be empty！";return false}h.input=b(h.input);if(!h.input.length){throw"wminputdown Element not found！";return false}h.input.attr("autocomplete","off");n=h.input.offset();m=h.input.attr("id");if(!m){m="down_list_input"+parseInt(Math.random()*999999);h.input.attr("id",m)}i=m+"_downbox";h.input.attr("for",i);this.$downBox=d('<div id="'+i+'" class="input_downlist" for="'+m+'"></div>');if(h.position==="fixed"){n.top=n.top-f()+h.input.outerHeight()}else{n.top=n.top+h.input.outerHeight()}this.$downBox.css({width:h.width||(h.input.outerWidth()-2),position:h.position||"absolute","z-index":h.zIndex,top:n.top,left:n.left,display:"none"});this.$downBox.data("instantiation",this);this.$downBox.data("createData",{input:h.input});this.$input=h.input;j.append(this.$downBox);e.call(this,h);this.html=function(p){if(p){o.$downBox.empty().append(p)}else{return o.$downBox.html()}d(window).resize();return o};this.append=function(p,q){o.$downBox.append(g.render(p));d(window).resize();typeof q==="function"&&q.call(o,h);return o};this.empty=function(p){o.$downBox.empty();d(window).resize();typeof p==="function"&&p.call(o,h);return o};this.setModel=function(p){if(typeof p==="string"){g=c(p)}return o};this.showDownList=function(p){o.$downBox.css("display","block");d(window).resize();return o};this.hideDownList=function(){o.$downBox.css("display","none");return o};typeof h.callback==="function"&&h.callback.call(this)};exports.Create=function(g){return new a(g)}});